<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management System - Student List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Global Styles */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        /* Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        /* Table Styles */
        table {
            border-collapse: separate;
            border-spacing: 0;
        }
        table th {
            background-color: #f9fafb;
        }
        table tr:hover {
            background-color: #f9fafb;
        }
        /* Student Image Styles */
        .student-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e5e7eb;
        }
        /* Modal Styles */
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        /* Form Styles */
        .form-input:focus {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        /* Button Styles */
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: white;
            color: #4b5563;
            border: 1px solid #d1d5db;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            background-color: #f3f4f6;
        }
        /* Card Styles */
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        /* Badge Styles */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-blue {
            background-color: #dbeafe;
            color: #1d4ed8;
        }
        .badge-green {
            background-color: #dcfce7;
            color: #166534;
        }
        /* Responsive Styles */
        @media (max-width: 768px) {
            .table-container {
                overflow-x: auto;
            }
            
            .modal-content {
                margin: 1rem;
                max-width: calc(100% - 2rem);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-graduation-cap text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-semibold text-gray-900">Student Management System</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="exportStudentsPDF()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                        <i class="fas fa-file-pdf mr-2"></i>Export All
                    </button>
                    <a href="add-student.html" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                        <i class="fas fa-user-plus mr-2"></i>Add Student
                    </a>
                </div>
            </div>
        </div>
    </header>
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Search and Filter -->
        <div class="bg-white rounded-lg shadow p-4 mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="relative flex-1">
                    <input type="text" id="searchInput" placeholder="Search students..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
                <div class="flex space-x-2">
                    <input type="text" id="groupFilter" placeholder="Filter by group..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>
        </div>
        <!-- Students Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Group</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tuition</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Student Row Template -->
                        <template id="studentRowTemplate">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-12 w-12">
                                            <img class="h-12 w-12 rounded-full object-cover" src="" alt="">
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900 student-name"></div>
                                            <div class="text-sm text-gray-500 student-email"></div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900 student-id"></div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900 student-phone"></div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 student-group">
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    <span class="student-amount"></span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                    <button class="export-pdf-btn text-indigo-600 hover:text-indigo-900 mr-3">
                                        <i class="fas fa-file-pdf"></i>
                                    </button>
                                    <a href="add-student.html" class="edit-btn text-blue-600 hover:text-blue-900 mr-3">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button class="delete-btn text-red-600 hover:text-red-900">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </template>
                        <!-- Students will be dynamically added here -->
                    </tbody>
                </table>
            </div>
            <div id="emptyState" class="text-center py-12 hidden">
                <i class="fas fa-user-graduate text-gray-300 text-5xl mb-4"></i>
                <h3 class="text-lg font-medium text-gray-900 mb-1">No students found</h3>
                <p class="text-gray-500 mb-4">Get started by adding a new student</p>
                <a href="add-student.html" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    <i class="fas fa-plus mr-2"></i>Add Student
                </a>
            </div>
        </div>
    </main>
    <!-- School Settings Modal -->
    <div id="schoolSettingsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full slide-in">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">School Information</h3>
                </div>
                <form id="schoolSettingsForm" class="px-6 py-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">School Name</label>
                        <input type="text" id="schoolNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">School Logo URL</label>
                        <input type="text" id="schoolLogoInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeSchoolSettings()" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Save Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        // Data structure
        let students = [];
        let schoolSettings = {
            name: "Excellence Academy",
            logo: "https://placehold.co/200x200/4f46e5/ffffff?text=EA"
        };
        
        // Initialize the application
        function init() {
            loadData();
            renderStudentsTable();
            setupEventListeners();
            checkSchoolSettings();
            
            // Check if we're returning from adding/editing a student
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            const studentId = urlParams.get('id');
            
            if (action === 'added') {
                showNotification('Student added successfully!', 'success');
            } else if (action === 'updated') {
                showNotification('Student updated successfully!', 'success');
            } else if (action === 'deleted') {
                showNotification('Student deleted successfully!', 'success');
            }
        }
        
        // Load data from localStorage
        function loadData() {
            const savedStudents = localStorage.getItem('students');
            if (savedStudents) {
                students = JSON.parse(savedStudents);
            }
            
            const savedSettings = localStorage.getItem('schoolSettings');
            if (savedSettings) {
                schoolSettings = JSON.parse(savedSettings);
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('schoolSettings', JSON.stringify(schoolSettings));
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // School settings form submission
            document.getElementById('schoolSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSchoolSettings();
            });
            
            // Search input
            document.getElementById('searchInput').addEventListener('input', filterStudents);
            
            // Group filter
            document.getElementById('groupFilter').addEventListener('input', filterStudents);
        }
        
        // Check if school settings exist
        function checkSchoolSettings() {
            if (!schoolSettings.name) {
                showSchoolSettingsModal();
            }
        }
        
        // Render students table
        function renderStudentsTable() {
            const tbody = document.getElementById('studentsTableBody');
            const emptyState = document.getElementById('emptyState');
            const template = document.getElementById('studentRowTemplate');
            
            // Clear existing rows (except the template)
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => row.remove());
            
            if (students.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            students.forEach(student => {
                // Clone the template
                const clone = document.importNode(template.content, true);
                
                // Populate the template with student data
                const img = clone.querySelector('img');
                img.src = student.image || 'https://placehold.co/200x200/e0e0e0/333?text=Photo';
                img.alt = student.name;
                
                clone.querySelector('.student-name').textContent = `${student.name} ${student.familyName}`;
                clone.querySelector('.student-email').textContent = student.email;
                clone.querySelector('.student-id').textContent = student.id;
                clone.querySelector('.student-phone').textContent = student.phone;
                clone.querySelector('.student-group').textContent = student.groupe || 'N/A';
                clone.querySelector('.student-amount').textContent = `$${parseFloat(student.amount || 0).toFixed(2)}`;
                
                // Set up action buttons
                const exportBtn = clone.querySelector('.export-pdf-btn');
                exportBtn.setAttribute('data-id', student.id);
                exportBtn.addEventListener('click', function() {
                    exportStudentPDF(this.getAttribute('data-id'));
                });
                
                const editBtn = clone.querySelector('.edit-btn');
                editBtn.setAttribute('href', `add-student.html?id=${student.id}`);
                
                const deleteBtn = clone.querySelector('.delete-btn');
                deleteBtn.setAttribute('data-id', student.id);
                deleteBtn.addEventListener('click', function() {
                    deleteStudent(this.getAttribute('data-id'));
                });
                
                // Add the populated row to the table
                tbody.appendChild(clone);
            });
        }
        
        // Delete student
        function deleteStudent(id) {
            if (confirm('Are you sure you want to delete this student?')) {
                students = students.filter(s => s.id !== id);
                saveData();
                renderStudentsTable();
                showNotification('Student deleted successfully!', 'success');
            }
        }
        
        // Export student PDF
        function exportStudentPDF(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add school logo and name
            if (schoolSettings.logo) {
                doc.addImage(schoolSettings.logo, 'JPEG', 15, 10, 30, 30);
            }
            
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text(schoolSettings.name, 50, 25);
            
            // Add title
            doc.setFontSize(14);
            doc.text('Student Registration Form', 105, 45, { align: 'center' });
            
            // Add barcode
            JsBarcode(doc, student.barcode, {
                format: "CODE128",
                width: 2,
                height: 30,
                displayValue: true,
                x: 150,
                y: 55
            });
            
            // Add student information
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            let yPos = 85;
            
            // Personal Information
            doc.setFont(undefined, 'bold');
            doc.text('Personal Information', 15, yPos);
            yPos += 10;
            
            doc.setFont(undefined, 'normal');
            doc.text(`Name: ${student.name} ${student.familyName}`, 15, yPos);
            yPos += 7;
            doc.text(`ID: ${student.id}`, 15, yPos);
            yPos += 7;
            doc.text(`Birth Date: ${student.birthDate || 'N/A'}`, 15, yPos);
            yPos += 7;
            doc.text(`Birth Place: ${student.birthPlace || 'N/A'}`, 15, yPos);
            yPos += 7;
            doc.text(`Gender: ${student.sexe}`, 15, yPos);
            yPos += 7;
            doc.text(`Email: ${student.email || 'N/A'}`, 15, yPos);
            yPos += 7;
            doc.text(`Phone: ${student.phone || 'N/A'}`, 15, yPos);
            yPos += 7;
            doc.text(`Group: ${student.groupe || 'N/A'}`, 15, yPos);
            yPos += 7;
            doc.text(`Monthly Tuition: $${parseFloat(student.amount || 0).toFixed(2)}`, 15, yPos);
            
            yPos += 15;
            
            // Parent Information
            doc.setFont(undefined, 'bold');
            doc.text('Parent/Guardian Information', 15, yPos);
            yPos += 10;
            
            doc.setFont(undefined, 'normal');
            doc.text(`Name: ${student.parentName || 'N/A'} ${student.parentFamilyName || 'N/A'}`, 15, yPos);
            yPos += 7;
            doc.text(`Email: ${student.parentEmail || 'N/A'}`, 15, yPos);
            yPos += 7;
            doc.text(`Phone: ${student.parentPhone || 'N/A'}`, 15, yPos);
            
            // Add signature lines
            yPos += 30;
            doc.text('Student Signature:', 15, yPos);
            doc.line(15, yPos + 5, 80, yPos + 5);
            
            doc.text('Parent Signature:', 120, yPos);
            doc.line(120, yPos + 5, 185, yPos + 5);
            
            yPos += 20;
            doc.text('Date:', 15, yPos);
            doc.line(15, yPos + 5, 50, yPos + 5);
            
            // Save the PDF with a dialog box for download path
            doc.save(`registration_${student.id}_${student.name}_${student.familyName}.pdf`);
        }
        
        // Export all students PDF
        function exportStudentsPDF() {
            if (students.length === 0) {
                showNotification('No students to export!', 'error');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add school logo and name
            if (schoolSettings.logo) {
                doc.addImage(schoolSettings.logo, 'JPEG', 15, 10, 30, 30);
            }
            
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text(schoolSettings.name, 50, 25);
            
            // Add title
            doc.setFontSize(14);
            doc.text('Students List', 105, 45, { align: 'center' });
            
            // Add date
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 55, { align: 'center' });
            
            // Add table
            const tableData = students.map(student => [
                student.id,
                `${student.name} ${student.familyName}`,
                student.email || 'N/A',
                student.phone || 'N/A',
                student.groupe || 'N/A',
                `$${parseFloat(student.amount || 0).toFixed(2)}`
            ]);
            
            doc.autoTable({
                head: [['ID', 'Name', 'Email', 'Phone', 'Group', 'Tuition']],
                body: tableData,
                startY: 65,
                theme: 'grid',
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                headStyles: {
                    fillColor: [79, 70, 229],
                    textColor: 255
                }
            });
            
            // Save the PDF
            doc.save(`students_list_${new Date().toISOString().split('T')[0]}.pdf`);
            showNotification('Students list exported successfully!', 'success');
        }
        
        // Filter students
        function filterStudents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const groupFilter = document.getElementById('groupFilter').value.toLowerCase();
            
            const filteredStudents = students.filter(student => {
                const matchesSearch = 
                    student.name.toLowerCase().includes(searchTerm) ||
                    student.familyName.toLowerCase().includes(searchTerm) ||
                    student.email.toLowerCase().includes(searchTerm) ||
                    student.phone.includes(searchTerm);
                    
                const matchesGroup = !groupFilter || (student.groupe && student.groupe.toLowerCase().includes(groupFilter));
                
                return matchesSearch && matchesGroup;
            });
            
            // Temporarily replace students array with filtered results
            const originalStudents = [...students];
            students = filteredStudents;
            renderStudentsTable();
            students = originalStudents;
        }
        
        // Show school settings modal
        function showSchoolSettingsModal() {
            document.getElementById('schoolNameInput').value = schoolSettings.name;
            document.getElementById('schoolLogoInput').value = schoolSettings.logo;
            document.getElementById('schoolSettingsModal').classList.remove('hidden');
        }
        
        // Close school settings modal
        function closeSchoolSettings() {
            document.getElementById('schoolSettingsModal').classList.add('hidden');
        }
        
        // Save school settings
        function saveSchoolSettings() {
            schoolSettings.name = document.getElementById('schoolNameInput').value;
            schoolSettings.logo = document.getElementById('schoolLogoInput').value;
            
            saveData();
            closeSchoolSettings();
            showNotification('School settings saved successfully!', 'success');
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-exclamation-circle' :
                        'fa-info-circle'
                    } mr-2"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
